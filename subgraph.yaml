specVersion: 0.0.4
schema:
  file: ./schema.graphql
dataSources:
  # POD MARKETPLACE V1
  - kind: ethereum/contract
    name: Marketplace
    network: mainnet
    source:
      address: "0xC1E088fC1323b20BCBee9bd1B9fC9546db5624C5"
      abi: Beanstalk
      startBlock: 14148400 # actual = 14148509
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Season
      abis:
        - name: Beanstalk
          file: ./abis/Beanstalk.json
        - name: UniswapV2Pair
          file: ./abis/UniswapV2Pair.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: PodListingCreated(indexed address,uint256,uint256,uint256,uint24,uint256,bool)
          handler: handlePodListingCreated
        - event: PodListingCancelled(indexed address,uint256)
          handler: handlePodListingCancelled
        - event: PodListingFilled(indexed address,indexed address,uint256,uint256,uint256)
          handler: handlePodListingFilled
        - event: PodOrderCreated(indexed address,bytes32,uint256,uint24,uint256)
          handler: handlePodOrderCreated
        - event: PodOrderFilled(indexed address,indexed address,bytes32,uint256,uint256,uint256)
          handler: handlePodOrderFilled
        - event: PodOrderCancelled(indexed address,bytes32)
          handler: handlePodOrderCancelled
      file: ./src/MarketplaceHandler.ts
  # POD MARKETPLACE V1 - REPLANTED
  - kind: ethereum/contract
    name: Marketplace-Replanted
    network: mainnet
    source:
      address: "0xC1E088fC1323b20BCBee9bd1B9fC9546db5624C5"
      abi: Beanstalk
      startBlock: 15277986
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Marketplace-Replanted
      abis:
        - name: Beanstalk
          file: ./abis/Beanstalk-Replanted.json
        - name: UniswapV2Pair
          file: ./abis/UniswapV2Pair.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: PodListingCreated(indexed address,uint256,uint256,uint256,uint24,uint256,uint8)
          handler: handlePodListingCreated_v1_1
      file: ./src/MarketplaceHandler.ts
  # POD MARKETPLACE V2
  - kind: ethereum/contract
    name: BIP29-PodMarketplace
    network: mainnet
    source:
      address: "0xC1E088fC1323b20BCBee9bd1B9fC9546db5624C5"
      abi: Beanstalk
      startBlock: 15277986
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - PodMarketplaceV2
      abis:
        - name: Beanstalk
          file: ./abis/Beanstalk-BIP29.json
        - name: UniswapV2Pair
          file: ./abis/UniswapV2Pair.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: PodListingCreated(indexed address,uint256,uint256,uint256,uint24,uint256,uint256,bytes,uint8,uint8)
          handler: handlePodListingCreated_v2
        - event: PodListingFilled(indexed address,indexed address,uint256,uint256,uint256,uint256)
          handler: handlePodListingFilled_v2
        - event: PodOrderCreated(indexed address,bytes32,uint256,uint24,uint256,uint256,bytes,uint8)
          handler: handlePodOrderCreated_v2
        - event: PodOrderFilled(indexed address,indexed address,bytes32,uint256,uint256,uint256,uint256)
          handler: handlePodOrderFilled_v2
      file: ./src/MarketplaceHandler.ts
